!function(){angular.module("livebase",["firebase"])}(),function(){"use strict";function matchTell(e,t){if(0===e.length)return!1;var r;return e.map(function(e,n,i){t.indexOf(e.cmd.toLowerCase())>-1&&(r=i[n])}),r}angular.module("livebase").provider("$livebase",function(){var e=!1,t=[];return{url:function(t){e=t},tell:function(e){t=e},$get:function(){return{url:e,tell:t}}}}).controller("LivebaseCtrl",["$scope","Bot",function(e,t){var r=new webkitSpeechRecognition;e.chats=t.all(),e.lb.send=function(){e.lb.input&&(t.send(e.lb.input),e.lb.input="")},e.lb.enter=function(r){13===r.keyCode&&e.lb.input&&(t.send(e.lb.input),e.lb.input="")},e.lb.listen=function(){r.start()},r.onresult=function(e){t.send(e.results[0][0].transcript)}}]).directive("livebase",function(){return{restrict:"E",controller:"LivebaseCtrl",controllerAs:"lb",transclude:!0,template:"<ng-transclude></ng-transclude>"}}).directive("lbInput",function(){return{require:"livebase",restrict:"E",replace:!0,template:'<input type="text" ng-model="lb.input" ng-keydown="lb.enter($event)">'}}).directive("lbSend",function(){return{require:"livebase",restrict:"E",replace:!0,transclude:!0,template:'<button ng-click="lb.send()"><ng-transclude></ng-transclude></button>'}}).directive("lbListen",function(){return{require:"livebase",restrict:"E",replace:!0,transclude:!0,template:'<button ng-click="lb.listen()"><ng-transclude></ng-transclude></button>'}}).service("Bot",function($http,$q,$location,$firebaseArray,$livebase){var chats=[];localStorage.getItem("livebaseid")||localStorage.setItem("livebaseid",Date.now().toString()+(Math.floor(1e5*Math.random())+1));var ref=new Firebase($livebase.url+localStorage.getItem("livebaseid"));return chats=$firebaseArray(ref),{send:function(text){var id;chats.$add({id:Date.now().toString(),text:text,type:"user"});var bypass=matchTell($livebase.tell,text.toLowerCase());if(bypass)bypass.reply&&chats.$add({id:Date.now().toString(),text:bypass.reply,type:"bot"}),bypass.link&&$location.hash(bypass.link);else{id=localStorage.getItem("livebaseid")?"&convo_id="+localStorage.getItem("livebaseid"):"";var url="https://samsungiotacademy.com/livebase/gui/plain/bot.php?format=json&submit=Go&say="+text+id;$http.get(url).then(function(response){for(var res=response.data.botsay,script=/<script\b[^>]*>([\s\S]*?)<\/script>/gm,scriptCap=/<Script\b[^>]*>([\s\S]*?)<\/Script>/gm,scr;scr=script.exec(res);)res=res.split(scr[0]).join("").trim(),eval(scr[1]);for(;scr=scriptCap.exec(res);)res=res.split(scr[0]).join("").trim(),eval(scr[1]);chats.$add({id:Date.now().toString(),text:res,type:"bot"})})}},all:function(){return chats}}})}();
