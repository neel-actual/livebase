!function(){angular.module("livebase",["firebase"])}(),function(){"use strict";angular.module("livebase").provider("$livebase",function(){var e=!1;return{url:function(t){e=t},$get:function(){return{url:e}}}}).controller("LivebaseCtrl",["$scope","Bot",function(e,t){e.chats=t.all(),e.lb.send=function(){e.lb.input&&(t.send(e.lb.input),e.lb.input="")},e.lb.enter=function(r){13===r.keyCode&&e.lb.input&&(t.send(e.lb.input),e.lb.input="")}}]).directive("livebase",function(){return{restrict:"E",controller:"LivebaseCtrl",controllerAs:"lb",transclude:!0,template:"<ng-transclude></ng-transclude>"}}).directive("lbInput",function(){return{require:"livebase",restrict:"E",replace:!0,template:'<input type="text" ng-model="lb.input" ng-keydown="lb.enter($event)">'}}).directive("lbSend",function(){return{require:"livebase",restrict:"E",replace:!0,template:'<button ng-click="lb.send()">Send</button>'}}).service("Bot",["$http","$q","$firebaseArray","$livebase",function($http,$q,$firebaseArray,$livebase){var chats=[];localStorage.getItem("livebaseid")||localStorage.setItem("livebaseid",Date.now().toString()+(Math.floor(1e5*Math.random())+1));var ref=new Firebase($livebase.url+localStorage.getItem("livebaseid"));return chats=$firebaseArray(ref),{send:function(text){chats.$add({id:Date.now().toString(),text:text,type:"user"});var url="https://samsungiotacademy.com/livebase/gui/plain/bot.php?format=json&submit=Go&say="+text+localStorage.getItem("livebaseid");$http.get(url).then(function(response){for(var res=response.data.botsay,script=/<script\b[^>]*>([\s\S]*?)<\/script>/gm,scriptCap=/<Script\b[^>]*>([\s\S]*?)<\/Script>/gm,scr;scr=script.exec(res);)res=res.split(scr[0]).join("").trim(),eval(scr[1]);for(;scr=scriptCap.exec(res);)res=res.split(scr[0]).join("").trim(),eval(scr[1]);chats.$add({id:Date.now().toString(),text:res,type:"bot"})})},all:function(){return chats}}}])}();
